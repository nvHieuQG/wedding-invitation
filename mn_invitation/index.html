<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quáº£n LÃ½ XÃ¡c Nháº­n Tham Dá»± â€“ VÄƒn CÆ°á»ng & Háº£i LÃ½</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Great+Vibes&family=Lora:ital,wght@0,400;0,500;1,400&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <style>
    /* â”€â”€ Reset & Variables â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --red:      #c8102e;
      --red-dk:   #9b0b22;
      --gold:     #d4af37;
      --gold-lt:  #f0d060;
      --cream:    #fdf6ec;
      --bg:       #f0f2f5;
      --card:     #ffffff;
      --text:     #1a1a2e;
      --text-2:   #5a6a7a;
      --border:   rgba(0,0,0,0.08);
      --yes-bg:   #e8f8f0;
      --yes-text: #1a7a4a;
      --no-bg:    #fff0f0;
      --no-text:  #c0392b;
      --shadow:   0 4px 24px rgba(0,0,0,0.07);
    }
    html { scroll-behavior: smooth; }
    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .admin-header {
      background: linear-gradient(135deg, var(--red-dk) 0%, var(--red) 60%, #e8203e 100%);
      color: white;
      padding: 28px 32px 24px;
      position: sticky; top: 0; z-index: 100;
      box-shadow: 0 4px 20px rgba(155,11,34,.35);
    }
    .header-inner {
      max-width: 1200px; margin: 0 auto;
      display: flex; align-items: center; justify-content: space-between;
      gap: 16px; flex-wrap: wrap;
    }
    .header-brand {
      display: flex; align-items: center; gap: 14px;
    }
    .brand-icon { font-size: 2rem; filter: drop-shadow(0 2px 6px rgba(0,0,0,.3)); }
    .brand-title {
      font-family: 'Playfair Display', serif;
      font-size: 1.25rem; font-weight: 700;
      letter-spacing: 1px;
    }
    .brand-sub {
      font-family: 'Great Vibes', cursive;
      font-size: 1.4rem; color: var(--gold-lt);
      display: block; line-height: 1;
    }
    .header-actions { display: flex; gap: 10px; flex-wrap: wrap; }
    .btn {
      padding: 9px 20px; border-radius: 8px;
      border: none; cursor: pointer;
      font-family: 'Inter', sans-serif;
      font-size: .82rem; font-weight: 600;
      letter-spacing: .5px;
      transition: all .2s ease;
      display: inline-flex; align-items: center; gap: 6px;
      text-decoration: none;
    }
    .btn-outline-white {
      background: rgba(255,255,255,0.15);
      color: white; border: 1.5px solid rgba(255,255,255,0.4);
      backdrop-filter: blur(4px);
    }
    .btn-outline-white:hover { background: rgba(255,255,255,0.25); transform: translateY(-1px); }
    .btn-white {
      background: white; color: var(--red-dk);
    }
    .btn-white:hover { background: var(--cream); transform: translateY(-1px); }
    .btn-danger {
      background: rgba(200,16,46,0.15);
      color: #ff6b6b; border: 1.5px solid rgba(200,16,46,0.3);
    }
    .btn-danger:hover { background: rgba(200,16,46,0.25); }

    /* â”€â”€ Main Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .main {
      max-width: 1200px; margin: 0 auto;
      padding: 32px 20px 60px;
    }

    /* â”€â”€ Stats Cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 16px; margin-bottom: 28px;
    }
    .stat-card {
      background: var(--card); border-radius: 16px;
      padding: 24px 20px;
      box-shadow: var(--shadow);
      border-left: 4px solid transparent;
      transition: transform .2s, box-shadow .2s;
    }
    .stat-card:hover { transform: translateY(-3px); box-shadow: 0 8px 32px rgba(0,0,0,.1); }
    .stat-card.all    { border-color: var(--gold); }
    .stat-card.yes    { border-color: #27ae60; }
    .stat-card.no     { border-color: var(--red); }
    .stat-card.guests { border-color: #3498db; }
    .stat-label {
      font-size: .72rem; font-weight: 600; text-transform: uppercase;
      letter-spacing: 1.5px; color: var(--text-2); margin-bottom: 8px;
    }
    .stat-num {
      font-family: 'Playfair Display', serif;
      font-size: 2.4rem; font-weight: 700; line-height: 1;
      color: var(--text);
    }
    .stat-desc { font-size: .75rem; color: var(--text-2); margin-top: 4px; }
    .stat-icon { font-size: 1.6rem; margin-bottom: 10px; display: block; }

    /* â”€â”€ Controls â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .controls {
      background: var(--card); border-radius: 16px;
      padding: 20px; box-shadow: var(--shadow);
      margin-bottom: 20px;
      display: flex; align-items: center; gap: 14px; flex-wrap: wrap;
    }
    .search-box {
      position: relative; flex: 1; min-width: 200px;
    }
    .search-box input {
      width: 100%; padding: 10px 16px 10px 40px;
      border: 1.5px solid var(--border);
      border-radius: 10px; font-family: 'Inter', sans-serif;
      font-size: .88rem; outline: none;
      transition: border-color .2s, box-shadow .2s;
      background: var(--bg);
    }
    .search-box input:focus {
      border-color: var(--gold);
      box-shadow: 0 0 0 3px rgba(212,175,55,.12);
    }
    .search-icon {
      position: absolute; left: 13px; top: 50%;
      transform: translateY(-50%); color: var(--text-2); font-size: .9rem;
    }
    .filter-select {
      padding: 10px 14px; border-radius: 10px;
      border: 1.5px solid var(--border);
      background: var(--bg); font-family: 'Inter', sans-serif;
      font-size: .88rem; cursor: pointer; outline: none;
    }
    .filter-select:focus { border-color: var(--gold); }

    /* â”€â”€ Table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .table-wrap {
      background: var(--card); border-radius: 16px;
      box-shadow: var(--shadow); overflow: hidden;
    }
    .table-head {
      padding: 18px 24px;
      border-bottom: 1px solid var(--border);
      display: flex; align-items: center; justify-content: space-between;
      flex-wrap: wrap; gap: 10px;
    }
    .table-head-title {
      font-size: .9rem; font-weight: 700; color: var(--text);
    }
    .table-count {
      font-size: .78rem; color: var(--text-2);
      background: var(--bg); padding: 4px 10px;
      border-radius: 20px; font-weight: 600;
    }
    table {
      width: 100%; border-collapse: collapse;
    }
    thead th {
      background: #fafafa;
      padding: 13px 20px;
      text-align: left; font-size: .72rem;
      font-weight: 700; text-transform: uppercase;
      letter-spacing: 1px; color: var(--text-2);
      border-bottom: 1px solid var(--border);
      white-space: nowrap;
    }
    tbody tr {
      border-bottom: 1px solid var(--border);
      transition: background .15s;
    }
    tbody tr:last-child { border-bottom: none; }
    tbody tr:hover { background: #fafbfc; }
    tbody td {
      padding: 14px 20px; font-size: .88rem; color: var(--text);
      vertical-align: middle;
    }
    .td-name { font-weight: 600; }
    .td-phone { color: var(--text-2); font-size: .83rem; }
    .td-msg {
      max-width: 200px; overflow: hidden;
      text-overflow: ellipsis; white-space: nowrap;
      color: var(--text-2); font-size: .83rem;
      font-style: italic;
    }
    .td-msg:hover { white-space: normal; }
    .td-time { color: var(--text-2); font-size: .78rem; white-space: nowrap; }
    .badge {
      display: inline-flex; align-items: center; gap: 5px;
      padding: 5px 12px; border-radius: 20px;
      font-size: .75rem; font-weight: 700; letter-spacing: .5px;
    }
    .badge-yes { background: var(--yes-bg); color: var(--yes-text); }
    .badge-no  { background: var(--no-bg);  color: var(--no-text); }
    .badge-pending { background: #fff8e0; color: #b8860b; }
    .btn-del {
      background: none; border: none; cursor: pointer;
      color: #ccc; font-size: .9rem; padding: 4px 8px;
      border-radius: 6px; transition: color .2s, background .2s;
    }
    .btn-del:hover { color: var(--red); background: var(--no-bg); }

    /* â”€â”€ Empty State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .empty-state {
      text-align: center; padding: 80px 20px;
    }
    .empty-icon { font-size: 3.5rem; margin-bottom: 16px; display: block; }
    .empty-title {
      font-family: 'Playfair Display', serif;
      font-size: 1.4rem; color: var(--text-2); margin-bottom: 8px;
    }
    .empty-sub { font-size: .88rem; color: var(--text-2); }

    /* â”€â”€ Confirm Dialog â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .confirm-overlay {
      position: fixed; inset: 0; z-index: 9999;
      background: rgba(0,0,0,0.5);
      display: none; align-items: center; justify-content: center;
    }
    .confirm-overlay.show { display: flex; }
    .confirm-box {
      background: white; border-radius: 16px;
      padding: 36px 32px; max-width: 380px; width: 90%;
      text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,.2);
    }
    .confirm-icon { font-size: 2.5rem; margin-bottom: 12px; display: block; }
    .confirm-title {
      font-family: 'Playfair Display', serif;
      font-size: 1.2rem; font-weight: 700; margin-bottom: 8px;
    }
    .confirm-sub { font-size: .88rem; color: var(--text-2); margin-bottom: 24px; }
    .confirm-actions { display: flex; gap: 10px; justify-content: center; }
    .btn-cancel {
      padding: 10px 24px; border-radius: 8px;
      border: 1.5px solid var(--border); background: white;
      font-family: 'Inter', sans-serif; font-size: .85rem;
      font-weight: 600; cursor: pointer;
      transition: background .2s;
    }
    .btn-cancel:hover { background: var(--bg); }
    .btn-confirm-del {
      padding: 10px 24px; border-radius: 8px;
      border: none; background: var(--red); color: white;
      font-family: 'Inter', sans-serif; font-size: .85rem;
      font-weight: 600; cursor: pointer;
      transition: opacity .2s;
    }
    .btn-confirm-del:hover { opacity: .85; }

    /* â”€â”€ Toast Snackbar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .snack {
      position: fixed; bottom: 28px; left: 50%; transform: translateX(-50%) translateY(80px);
      background: #1a1a2e; color: white;
      padding: 12px 24px; border-radius: 10px;
      font-size: .85rem; font-weight: 500;
      transition: transform .3s cubic-bezier(0.34,1.56,0.64,1), opacity .3s;
      opacity: 0; z-index: 9999; white-space: nowrap;
      box-shadow: 0 8px 32px rgba(0,0,0,.25);
    }
    .snack.show { transform: translateX(-50%) translateY(0); opacity: 1; }

    /* â”€â”€ Responsive: Tablet (â‰¤ 1024px) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 1024px) {
      .main { padding: 24px 16px 60px; }
      .td-msg { max-width: 140px; }
    }

    /* â”€â”€ Responsive: Mobile (â‰¤ 768px) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 768px) {

      /* â”€â”€ Header â”€â”€ */
      .admin-header { padding: 14px 16px; }
      .brand-icon   { font-size: 1.5rem; }
      .brand-title  { font-size: 1rem; }
      .brand-sub    { font-size: 1.15rem; }
      .btn          { padding: 8px 12px; font-size: .76rem; }

      /* â”€â”€ Main â”€â”€ */
      .main { padding: 14px 10px 50px; }

      /* â”€â”€ Stats: layout ngang compact â”€â”€ */
      .stats-grid {
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-bottom: 14px;
      }
      .stat-card {
        padding: 14px 12px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        gap: 12px;
        border-left: none;
        border-bottom: 3px solid transparent;
      }
      .stat-card.all    { border-bottom-color: var(--gold); }
      .stat-card.yes    { border-bottom-color: #27ae60; }
      .stat-card.no     { border-bottom-color: var(--red); }
      .stat-card.guests { border-bottom-color: #3498db; }
      .stat-icon  { font-size: 1.6rem; margin: 0; flex-shrink: 0; }
      .stat-num   { font-size: 1.7rem; line-height: 1; }
      .stat-label { font-size: .6rem; margin-bottom: 3px; }
      .stat-desc  { display: none; }

      /* â”€â”€ Controls: xáº¿p dá»c â”€â”€ */
      .controls {
        flex-direction: column;
        align-items: stretch;
        padding: 12px;
        gap: 8px;
        border-radius: 12px;
        margin-bottom: 14px;
      }
      .search-box   { min-width: unset; }
      .filter-select { width: 100%; }

      /* â”€â”€ Table â†’ Card layout â”€â”€ */
      .table-wrap { border-radius: 14px; overflow: visible; }
      .table-head { padding: 12px 14px; }

      table  { display: block; }
      thead  { display: none; }
      tbody  { display: flex; flex-direction: column; gap: 10px; padding: 10px; }

      tbody tr {
        display: block;
        position: relative;
        padding: 14px 44px 36px 14px;
        border: 1px solid var(--border);
        border-radius: 14px;
        background: white;
        box-shadow: 0 2px 10px rgba(0,0,0,.05);
        transition: box-shadow .2s;
      }
      tbody tr:hover { box-shadow: 0 5px 20px rgba(0,0,0,.1); }

      tbody td {
        display: block;
        padding: 0;
        border: none;
        font-size: .875rem;
      }
      tbody td::before { display: none; }

      /* TÃªn */
      tbody td.td-name {
        font-size: 1rem;
        font-weight: 700;
        color: var(--text);
        padding-right: 80px;
        margin-bottom: 8px;
      }

      /* Badge */
      tbody td:nth-child(3) { margin-bottom: 8px; }

      /* SÄT & sá»‘ ngÆ°á»i cÃ¹ng hÃ ng */
      tbody td.td-phone { display: inline-block; font-size: .8rem; color: var(--text-2); }
      tbody td.td-phone::after { content: ' Â· '; }
      tbody td:nth-child(4)    { display: inline-block; font-size: .8rem; color: var(--text-2); }

      /* Lá»i nháº¯n */
      tbody td.td-msg {
        display: block;
        max-width: unset;
        white-space: normal;
        font-size: .8rem;
        color: var(--text-2);
        font-style: italic;
        margin-top: 10px;
        padding-top: 10px;
        border-top: 1px dashed rgba(0,0,0,.08);
      }

      /* Thá»i gian â€“ absolute top-right */
      tbody td.td-time {
        position: absolute;
        top: 14px; right: 14px;
        font-size: .7rem;
        color: var(--text-2);
        white-space: nowrap;
      }

      /* NÃºt xÃ³a â€“ absolute bottom-right */
      tbody td:last-child {
        position: absolute;
        bottom: 8px; right: 8px;
      }
      .btn-del { color: #ddd; }
    }

    /* â”€â”€ Responsive: Small Mobile (â‰¤ 480px) â”€â”€â”€ */
    @media (max-width: 480px) {
      .btn-white   { display: none; }
      .brand-title { font-size: .9rem; }

      .stats-grid { gap: 8px; }
      .stat-card  { padding: 12px 10px; gap: 8px; }
      .stat-icon  { font-size: 1.3rem; }
      .stat-num   { font-size: 1.4rem; }

      .snack {
        left: 10px; right: 10px;
        transform: translateY(80px);
        text-align: center;
        white-space: normal;
        width: auto;
      }
      .snack.show { transform: translateY(0); }
    }
  </style>
</head>
<body>

  <!-- â–ˆâ–ˆ HEADER â–ˆâ–ˆ -->
  <header class="admin-header">
    <div class="header-inner">
      <div class="header-brand">
        <span class="brand-icon">ğŸ’</span>
        <div>
          <div class="brand-title">Quáº£n LÃ½ Danh SÃ¡ch</div>
          <span class="brand-sub">VÄƒn CÆ°á»ng & Háº£i LÃ½</span>
        </div>
      </div>
      <div class="header-actions">
        <!-- âš ï¸ Trá» lÃªn thÆ° má»¥c cha vÃ¬ file nÃ y náº±m trong mn_invitation/ -->
        <a href="../index.html" class="btn btn-outline-white">â† Vá» Thiá»‡p</a>
        <button class="btn btn-white" id="btn-export" onclick="exportCSV()">â¬‡ Xuáº¥t CSV</button>
        <button class="btn btn-danger" onclick="confirmClearAll()">ğŸ—‘ XÃ³a táº¥t cáº£</button>
      </div>
    </div>
  </header>

  <!-- â–ˆâ–ˆ MAIN â–ˆâ–ˆ -->
  <main class="main">

    <!-- Stats -->
    <div class="stats-grid" id="stats-grid">
      <div class="stat-card all">
        <span class="stat-icon">ğŸ“‹</span>
        <div>
          <div class="stat-label">Tá»•ng pháº£n há»“i</div>
          <div class="stat-num" id="stat-total">0</div>
          <div class="stat-desc">ÄÃ£ gá»­i xÃ¡c nháº­n</div>
        </div>
      </div>
      <div class="stat-card yes">
        <span class="stat-icon">âœ…</span>
        <div>
          <div class="stat-label">Sáº½ tham dá»±</div>
          <div class="stat-num" id="stat-yes">0</div>
          <div class="stat-desc">KhÃ¡ch xÃ¡c nháº­n Ä‘áº¿n</div>
        </div>
      </div>
      <div class="stat-card no">
        <span class="stat-icon">âŒ</span>
        <div>
          <div class="stat-label">KhÃ´ng Ä‘áº¿n</div>
          <div class="stat-num" id="stat-no">0</div>
          <div class="stat-desc">Váº¯ng máº·t cÃ³ lÃ½ do</div>
        </div>
      </div>
      <div class="stat-card guests">
        <span class="stat-icon">ğŸ‘¥</span>
        <div>
          <div class="stat-label">Tá»•ng khÃ¡ch</div>
          <div class="stat-num" id="stat-guests">0</div>
          <div class="stat-desc">NgÆ°á»i + ngÆ°á»i Ä‘i cÃ¹ng</div>
        </div>
      </div>
    </div>

    <!-- Controls -->
    <div class="controls">
      <div class="search-box">
        <span class="search-icon">ğŸ”</span>
        <input type="text" id="search-input" placeholder="TÃ¬m theo tÃªn, sá»‘ Ä‘iá»‡n thoáº¡i..." oninput="render()" />
      </div>
      <select class="filter-select" id="filter-attend" onchange="render()">
        <option value="">Táº¥t cáº£</option>
        <option value="yes">âœ… Sáº½ tham dá»±</option>
        <option value="no">âŒ KhÃ´ng Ä‘áº¿n</option>
      </select>
      <select class="filter-select" id="filter-sort" onchange="render()">
        <option value="newest">Má»›i nháº¥t trÆ°á»›c</option>
        <option value="oldest">CÅ© nháº¥t trÆ°á»›c</option>
        <option value="name">TÃªn Aâ†’Z</option>
      </select>
    </div>

    <!-- Table -->
    <div class="table-wrap">
      <div class="table-head">
        <div class="table-head-title">ğŸ“‹ Danh SÃ¡ch XÃ¡c Nháº­n</div>
        <span class="table-count" id="result-count">0 káº¿t quáº£</span>
      </div>
      <div id="table-body-wrap">
        <!-- Rendered by JS -->
      </div>
    </div>

  </main>

  <!-- â–ˆâ–ˆ CONFIRM DIALOG â–ˆâ–ˆ -->
  <div class="confirm-overlay" id="confirm-overlay">
    <div class="confirm-box">
      <span class="confirm-icon" id="confirm-icon">âš ï¸</span>
      <div class="confirm-title" id="confirm-title">XÃ¡c nháº­n</div>
      <div class="confirm-sub"  id="confirm-sub">Báº¡n cÃ³ cháº¯c cháº¯n khÃ´ng?</div>
      <div class="confirm-actions">
        <button class="btn-cancel" onclick="closeConfirm()">Huá»·</button>
        <button class="btn-confirm-del" id="confirm-ok">Äá»“ng Ã½</button>
      </div>
    </div>
  </div>

  <!-- â–ˆâ–ˆ SNACK BAR â–ˆâ–ˆ -->
  <div class="snack" id="snack"></div>

  <script>
    const KEY = 'wedding_rsvp';

    function loadData()    { return JSON.parse(localStorage.getItem(KEY) || '[]'); }
    function saveData(arr) { localStorage.setItem(KEY, JSON.stringify(arr)); }

    function formatTime(iso) {
      if (!iso) return 'â€”';
      const d = new Date(iso);
      const p = n => String(n).padStart(2, '0');
      return `${p(d.getDate())}/${p(d.getMonth()+1)}/${d.getFullYear()} ${p(d.getHours())}:${p(d.getMinutes())}`;
    }

    function showSnack(msg, ms = 2800) {
      const el = document.getElementById('snack');
      el.textContent = msg;
      el.classList.add('show');
      setTimeout(() => el.classList.remove('show'), ms);
    }

    function updateStats(data) {
      const yes    = data.filter(r => r.attend === 'yes');
      const no     = data.filter(r => r.attend === 'no');
      const guests = data.reduce((s, r) => s + (r.attend === 'yes' ? (r.guests || 0) + 1 : 0), 0);
      document.getElementById('stat-total').textContent  = data.length;
      document.getElementById('stat-yes').textContent    = yes.length;
      document.getElementById('stat-no').textContent     = no.length;
      document.getElementById('stat-guests').textContent = guests;
    }

    function render() {
      const search  = document.getElementById('search-input').value.toLowerCase();
      const filterA = document.getElementById('filter-attend').value;
      const sortBy  = document.getElementById('filter-sort').value;

      let data = loadData();
      updateStats(data);

      if (filterA) data = data.filter(r => r.attend === filterA);
      if (search)  data = data.filter(r =>
        (r.name    || '').toLowerCase().includes(search) ||
        (r.phone   || '').toLowerCase().includes(search) ||
        (r.message || '').toLowerCase().includes(search)
      );

      if (sortBy === 'newest') data.sort((a, b) => b.id - a.id);
      else if (sortBy === 'oldest') data.sort((a, b) => a.id - b.id);
      else if (sortBy === 'name')   data.sort((a, b) => (a.name||'').localeCompare(b.name||'', 'vi'));

      document.getElementById('result-count').textContent = `${data.length} káº¿t quáº£`;
      const wrap = document.getElementById('table-body-wrap');

      if (data.length === 0) {
        wrap.innerHTML = `
          <div class="empty-state">
            <span class="empty-icon">ğŸ’Œ</span>
            <div class="empty-title">ChÆ°a cÃ³ xÃ¡c nháº­n nÃ o</div>
            <div class="empty-sub">Khi khÃ¡ch gá»­i form, danh sÃ¡ch sáº½ hiá»ƒn thá»‹ táº¡i Ä‘Ã¢y.</div>
          </div>`;
        return;
      }

      const rows = data.map(r => {
        const bc = r.attend==='yes' ? 'badge-yes' : r.attend==='no' ? 'badge-no' : 'badge-pending';
        const bt = r.attend==='yes' ? 'âœ… Tham dá»±' : r.attend==='no' ? 'âŒ KhÃ´ng Ä‘áº¿n' : 'â³ ChÆ°a chá»n';
        const g  = r.attend==='yes' ? `+${r.guests||0} ngÆ°á»i` : 'â€”';
        return `
          <tr>
            <td data-label="Há» vÃ  tÃªn"    class="td-name">${esc(r.name||'â€”')}</td>
            <td data-label="Äiá»‡n thoáº¡i"   class="td-phone">${esc(r.phone||'â€”')}</td>
            <td data-label="Tráº¡ng thÃ¡i"><span class="badge ${bc}">${bt}</span></td>
            <td data-label="NgÆ°á»i Ä‘i cÃ¹ng">${g}</td>
            <td data-label="Lá»i nháº¯n"     class="td-msg" title="${esc(r.message||'')}">${esc(r.message||'â€”')}</td>
            <td data-label="Thá»i gian"    class="td-time">${formatTime(r.time)}</td>
            <td data-label=""><button class="btn-del" onclick="confirmDelete(${r.id})">ğŸ—‘</button></td>
          </tr>`;
      }).join('');

      wrap.innerHTML = `
        <table>
          <thead>
            <tr>
              <th>Há» vÃ  tÃªn</th><th>Äiá»‡n thoáº¡i</th><th>Tráº¡ng thÃ¡i</th>
              <th>NgÆ°á»i Ä‘i cÃ¹ng</th><th>Lá»i nháº¯n</th><th>Thá»i gian</th><th></th>
            </tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>`;
    }

    function esc(s) {
      return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
    }

    let _cb = null;
    function confirmDelete(id) {
      openConfirm('ğŸ—‘ï¸','XÃ³a xÃ¡c nháº­n nÃ y?','HÃ nh Ä‘á»™ng nÃ y khÃ´ng thá»ƒ hoÃ n tÃ¡c.', () => {
        saveData(loadData().filter(r => r.id !== id));
        render(); showSnack('âœ… ÄÃ£ xÃ³a xÃ¡c nháº­n');
      });
    }
    function confirmClearAll() {
      const n = loadData().length;
      if (!n) { showSnack('Danh sÃ¡ch Ä‘ang trá»‘ng!'); return; }
      openConfirm('âš ï¸',`XÃ³a táº¥t cáº£ ${n} xÃ¡c nháº­n?`,'ToÃ n bá»™ dá»¯ liá»‡u sáº½ bá»‹ xÃ³a vÄ©nh viá»…n.', () => {
        localStorage.removeItem(KEY); render(); showSnack('ğŸ—‘ ÄÃ£ xÃ³a toÃ n bá»™ danh sÃ¡ch');
      });
    }
    function openConfirm(icon, title, sub, cb) {
      document.getElementById('confirm-icon').textContent  = icon;
      document.getElementById('confirm-title').textContent = title;
      document.getElementById('confirm-sub').textContent   = sub;
      _cb = cb;
      document.getElementById('confirm-overlay').classList.add('show');
      document.getElementById('confirm-ok').onclick = () => { closeConfirm(); cb(); };
    }
    function closeConfirm() {
      document.getElementById('confirm-overlay').classList.remove('show');
      _cb = null;
    }
    document.getElementById('confirm-overlay').addEventListener('click', e => {
      if (e.target === document.getElementById('confirm-overlay')) closeConfirm();
    });

    function exportCSV() {
      const data = loadData();
      if (!data.length) { showSnack('KhÃ´ng cÃ³ dá»¯ liá»‡u Ä‘á»ƒ xuáº¥t!'); return; }
      const header = ['ID','Há» tÃªn','Äiá»‡n thoáº¡i','Tham dá»±','NgÆ°á»i Ä‘i cÃ¹ng','Lá»i nháº¯n','Thá»i gian'];
      const rows = data.map(r => [
        r.id,
        `"${(r.name||'').replace(/"/g,'""')}"`,
        `"${(r.phone||'').replace(/"/g,'""')}"`,
        r.attend==='yes'?'CÃ³':r.attend==='no'?'KhÃ´ng':'ChÆ°a chá»n',
        r.attend==='yes'?(r.guests||0):0,
        `"${(r.message||'').replace(/"/g,'""')}"`,
        formatTime(r.time),
      ]);
      const csv  = '\uFEFF' + [header.join(','), ...rows.map(r=>r.join(','))].join('\r\n');
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url  = URL.createObjectURL(blob);
      const a    = Object.assign(document.createElement('a'), { href: url, download: `rsvp_${new Date().toISOString().slice(0,10)}.csv` });
      a.click(); URL.revokeObjectURL(url);
      showSnack(`âœ… ÄÃ£ xuáº¥t ${data.length} báº£n ghi`);
    }

    render();
    setInterval(render, 30000);
  </script>
</body>
</html>
